{%- liquid
  assign header_tag = 'div'
  if section.settings.sticky_header_type != 'none'
    assign header_tag = 'sticky-header'
  endif
-%}

<{{ header_tag }}
  {% if header_tag == 'sticky-header' %}
    data-sticky-type="{{ section.settings.sticky_header_type }}"
  {% endif %}
  class="header-wrapper color-{{ section.settings.color_scheme }} gradient{% if section.settings.show_line_separator %} header-wrapper--border-bottom{% endif %}"
>
  <header class="sticky top-0 z-50 bg-background/95 backdrop-blur-sm border-b border-border">
    <div class="container mx-auto px-4">
      <div class="flex items-center justify-between h-16 lg:h-20">
        <!-- Logo -->
        <a href="/" class="flex items-center">
          <img
            src="//images.squarespace-cdn.com/content/v1/67da0c2c5d3b414ebdd380a0/98398d47-4a7a-44bb-a374-962a6d6df255/Whiffed+Aroma+main+transparent.png?format=1500w"
            alt="Whiffed Aromas"
            class="w-16 h-16 lg:w-20 lg:h-20"
            loading="eager"
          >
        </a>

        <!-- Desktop Navigation -->
        <nav class="hidden lg:flex items-center gap-8">
          <a href="/" class="text-sm font-medium hover:text-primary transition-colors">HOME</a>

          <!-- Shop Dropdown -->
          <div class="relative group">
            <button class="text-sm font-medium hover:text-primary transition-colors flex items-center gap-1">
              SHOP
              <svg
                class="h-3 w-3 transition-transform group-hover:rotate-180"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m6 9 6 6 6-6"></path>
              </svg>
            </button>

            <!-- Mega Menu -->
            <div class="absolute top-full left-0 w-96 bg-background border rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 mt-2">
              <div class="p-6">
                <div class="grid grid-cols-2 gap-6">
                  <div>
                    <h3 class="font-semibold mb-3">By Category</h3>
                    <ul class="space-y-2">
                      <li>
                        <a href="/collections/home-diffusers" class="text-sm hover:text-primary transition-colors"
                          >Home Diffusers</a
                        >
                      </li>
                      <li>
                        <a href="/collections/car-diffusers" class="text-sm hover:text-primary transition-colors"
                          >Car Diffusers</a
                        >
                      </li>
                      <li>
                        <a href="/collections/commercial" class="text-sm hover:text-primary transition-colors"
                          >Commercial</a
                        >
                      </li>
                      <li>
                        <a href="/collections/accessories" class="text-sm hover:text-primary transition-colors"
                          >Accessories</a
                        >
                      </li>
                    </ul>
                  </div>
                  <div>
                    <h3 class="font-semibold mb-3">Collections</h3>
                    <ul class="space-y-2">
                      <li>
                        <a href="/collections/premium" class="text-sm hover:text-primary transition-colors">Premium</a>
                      </li>
                      <li>
                        <a href="/collections/fall-vibes" class="text-sm hover:text-primary transition-colors"
                          >Fall Vibes</a
                        >
                      </li>
                      <li>
                        <a href="/collections/best-sellers" class="text-sm hover:text-primary transition-colors"
                          >Best Sellers</a
                        >
                      </li>
                      <li>
                        <a href="/collections/new-arrivals" class="text-sm hover:text-primary transition-colors"
                          >New Arrivals</a
                        >
                      </li>
                    </ul>
                  </div>
                </div>
                <div class="mt-6 pt-4 border-t border-border">
                  <div class="flex items-center gap-4">
                    <div class="w-16 h-16 bg-muted rounded-lg flex items-center justify-center">
                      <svg class="w-8 h-8 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v18m9-9H3"></path>
                      </svg>
                    </div>
                    <div>
                      <h4 class="font-medium">Featured Product</h4>
                      <p class="text-sm text-muted-foreground">Premium Home Diffuser</p>
                      <a href="/products/premium-diffuser" class="text-sm text-primary hover:underline">Shop Now â†’</a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Scents Dropdown -->
          <div class="relative group">
            <button class="text-sm font-medium hover:text-primary transition-colors flex items-center gap-1">
              SCENTS
              <svg
                class="h-3 w-3 transition-transform group-hover:rotate-180"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m6 9 6 6 6-6"></path>
              </svg>
            </button>

            <!-- Scents Mega Menu -->
            <div class="absolute top-full left-0 w-80 bg-background border rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 mt-2">
              <div class="p-6">
                <div class="grid grid-cols-1 gap-6">
                  <div>
                    <h3 class="font-semibold mb-3">By Fragrance Family</h3>
                    <ul class="space-y-2">
                      <li>
                        <a href="/collections/floral" class="text-sm hover:text-primary transition-colors">Floral</a>
                      </li>
                      <li>
                        <a href="/collections/woody" class="text-sm hover:text-primary transition-colors">Woody</a>
                      </li>
                      <li>
                        <a href="/collections/fresh" class="text-sm hover:text-primary transition-colors">Fresh</a>
                      </li>
                      <li>
                        <a href="/collections/oriental" class="text-sm hover:text-primary transition-colors"
                          >Oriental</a
                        >
                      </li>
                    </ul>
                  </div>
                  <div>
                    <h3 class="font-semibold mb-3">By Room Type</h3>
                    <ul class="space-y-2">
                      <li>
                        <a href="/collections/living-room" class="text-sm hover:text-primary transition-colors"
                          >Living Room</a
                        >
                      </li>
                      <li>
                        <a href="/collections/bedroom" class="text-sm hover:text-primary transition-colors">Bedroom</a>
                      </li>
                      <li>
                        <a href="/collections/office" class="text-sm hover:text-primary transition-colors">Office</a>
                      </li>
                      <li>
                        <a href="/collections/refills" class="text-sm hover:text-primary transition-colors"
                          >Refills & Bundles</a
                        >
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <a href="/collections/bundles" class="text-sm font-medium hover:text-primary transition-colors">BUNDLES</a>
          <a href="/collections/machines" class="text-sm font-medium hover:text-primary transition-colors">MACHINES</a>
          <a href="/pages/about" class="text-sm font-medium hover:text-primary transition-colors">COMPANY</a>
        </nav>

        <!-- Actions -->
        <div class="flex items-center gap-2 lg:gap-4">
          <button
            id="search-trigger"
            class="flex items-center justify-center size-9 hover:bg-accent rounded-md transition-colors"
          >
            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path>
            </svg>
          </button>

          <a
            href="/account"
            class="hidden md:flex items-center justify-center size-9 hover:bg-accent rounded-md transition-colors"
          >
            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
            </svg>
          </a>

          <button
            id="cart-trigger"
            class="flex items-center justify-center size-9 hover:bg-accent rounded-md transition-colors relative"
          >
            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.5 5M7 13l2.5 5m6-5v6a2 2 0 01-2 2H9a2 2 0 01-2-2v-6m8 0V9a2 2 0 00-2-2H9a2 2 0 00-2 2v4.01"></path>
            </svg>
            <span class="absolute -top-1 -right-1 bg-primary text-primary-foreground text-xs rounded-full w-5 h-5 flex items-center justify-center"
              >0</span
            >
          </button>

          <button
            id="mobile-menu-trigger"
            class="lg:hidden flex items-center justify-center size-9 hover:bg-accent rounded-md transition-colors"
          >
            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- Search Popup -->
  <div
    id="search-popup"
    class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 opacity-0 invisible transition-all duration-300"
  >
    <div class="flex items-start justify-center min-h-screen pt-20 px-4">
      <div class="bg-background rounded-lg shadow-xl w-full max-w-2xl transform scale-95 transition-transform duration-300">
        <div class="p-6">
          <div class="flex items-center gap-4 mb-6">
            <div class="flex-1 relative">
              <input
                type="text"
                id="search-input"
                placeholder="Search products, collections..."
                class="w-full px-4 py-3 border border-border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent outline-none"
              >
              <svg
                class="absolute right-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.3-4.3"></path>
              </svg>
            </div>
            <button id="search-close" class="p-2 hover:bg-accent rounded-lg transition-colors">
              <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>

          <div id="search-results" class="space-y-4">
            <!-- Popular Searches -->
            <div>
              <h3 class="font-medium text-foreground mb-3">Popular Searches</h3>
              <div class="flex flex-wrap gap-2">
                <span class="px-3 py-1 bg-muted rounded-full text-sm cursor-pointer hover:bg-accent transition-colors"
                  >Home Diffuser</span
                >
                <span class="px-3 py-1 bg-muted rounded-full text-sm cursor-pointer hover:bg-accent transition-colors"
                  >Car Scents</span
                >
                <span class="px-3 py-1 bg-muted rounded-full text-sm cursor-pointer hover:bg-accent transition-colors"
                  >Lavender</span
                >
                <span class="px-3 py-1 bg-muted rounded-full text-sm cursor-pointer hover:bg-accent transition-colors"
                  >Bundle Deals</span
                >
              </div>
            </div>

            <!-- Quick Links -->
            <div>
              <h3 class="font-medium text-foreground mb-3">Quick Links</h3>
              <div class="space-y-2">
                <a
                  href="/collections/all"
                  class="flex items-center gap-3 p-2 hover:bg-accent rounded-lg transition-colors"
                >
                  <div class="w-8 h-8 bg-muted rounded flex items-center justify-center">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                    </svg>
                  </div>
                  <span class="text-sm">All Products</span>
                </a>
                <a
                  href="/collections/new"
                  class="flex items-center gap-3 p-2 hover:bg-accent rounded-lg transition-colors"
                >
                  <div class="w-8 h-8 bg-muted rounded flex items-center justify-center">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v18m9-9H3"></path>
                    </svg>
                  </div>
                  <span class="text-sm">New Arrivals</span>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Mobile Menu -->
  <div
    id="mobile-menu"
    class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 opacity-0 invisible transition-all duration-300 lg:hidden"
  >
    <div class="absolute right-0 top-0 h-full w-full max-w-sm bg-background transform translate-x-full transition-transform duration-300">
      <div class="flex flex-col h-full">
        <!-- Header -->
        <div class="flex items-center justify-between p-4 border-b border-border">
          <h2 class="text-lg font-semibold">Menu</h2>
          <div class="flex items-center gap-2">
            <a href="/account" class="p-2 hover:bg-accent rounded-lg transition-colors">
              <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
              </svg>
            </a>
            <button class="p-2 hover:bg-accent rounded-lg transition-colors">
              <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.5 5M7 13l2.5 5m6-5v6a2 2 0 01-2 2H9a2 2 0 01-2-2v-6m8 0V9a2 2 0 00-2-2H9a2 2 0 00-2 2v4.01"></path>
              </svg>
            </button>
            <button id="mobile-menu-close" class="p-2 hover:bg-accent rounded-lg transition-colors">
              <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>
        </div>

        <!-- Navigation -->
        <div class="flex-1 overflow-y-auto">
          <div class="p-4">
            <h3 class="text-xs font-semibold text-muted-foreground uppercase tracking-wider mb-4">EXPLORE</h3>

            <div class="space-y-1">
              <button
                class="mobile-menu-item w-full flex items-center justify-between p-3 hover:bg-accent rounded-lg transition-colors text-left"
                data-target="home-diffusers"
              >
                <span class="font-medium">Home Diffusers</span>
                <svg class="h-4 w-4 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
              </button>

              <button
                class="mobile-menu-item w-full flex items-center justify-between p-3 hover:bg-accent rounded-lg transition-colors text-left"
                data-target="car-diffusers"
              >
                <span class="font-medium">Car Diffusers</span>
                <svg class="h-4 w-4 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
              </button>

              <button
                class="mobile-menu-item w-full flex items-center justify-between p-3 hover:bg-accent rounded-lg transition-colors text-left"
                data-target="scent-collections"
              >
                <span class="font-medium">Scent Collections</span>
                <svg class="h-4 w-4 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
              </button>

              <button
                class="mobile-menu-item w-full flex items-center justify-between p-3 hover:bg-accent rounded-lg transition-colors text-left"
                data-target="bundles"
              >
                <span class="font-medium">Bundles & Deals</span>
                <svg class="h-4 w-4 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
              </button>

              <a
                href="/pages/about"
                class="w-full flex items-center justify-between p-3 hover:bg-accent rounded-lg transition-colors text-left"
              >
                <span class="font-medium">About Whiffed</span>
                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
              </a>
            </div>
          </div>

          <!-- Featured Products -->
          <div class="p-4 border-t border-border">
            <h3 class="text-xs font-semibold text-muted-foreground uppercase tracking-wider mb-4">FEATURED PRODUCTS</h3>

            <div class="space-y-3">
              <div class="flex items-center gap-3 p-2 hover:bg-accent rounded-lg transition-colors">
                <div class="w-12 h-12 bg-muted rounded-lg flex items-center justify-center">
                  <svg class="w-6 h-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v18m9-9H3"></path>
                  </svg>
                </div>
                <div class="flex-1">
                  <h4 class="font-medium text-sm">Premium Home Diffuser</h4>
                  <p class="text-xs text-muted-foreground">$129.99</p>
                </div>
              </div>

              <div class="flex items-center gap-3 p-2 hover:bg-accent rounded-lg transition-colors">
                <div class="w-12 h-12 bg-muted rounded-lg flex items-center justify-center">
                  <svg class="w-6 h-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v18m9-9H3"></path>
                  </svg>
                </div>
                <div class="flex-1">
                  <h4 class="font-medium text-sm">Car Scent Bundle</h4>
                  <p class="text-xs text-muted-foreground">$49.99</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- JavaScript -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      console.log('Enhanced header script loaded');

      // Search Popup
      const searchTrigger = document.getElementById('search-trigger');
      const searchPopup = document.getElementById('search-popup');
      const searchClose = document.getElementById('search-close');
      const searchInput = document.getElementById('search-input');

      if (searchTrigger && searchPopup) {
        searchTrigger.addEventListener('click', (e) => {
          e.preventDefault();
          console.log('Search trigger clicked');
          searchPopup.classList.remove('opacity-0', 'invisible');
          const transformEl = searchPopup.querySelector('.transform');
          if (transformEl) {
            transformEl.classList.remove('scale-95');
          }
          if (searchInput) {
            setTimeout(() => searchInput.focus(), 100);
          }
        });
      }

      if (searchClose && searchPopup) {
        searchClose.addEventListener('click', (e) => {
          e.preventDefault();
          searchPopup.classList.add('opacity-0', 'invisible');
          const transformEl = searchPopup.querySelector('.transform');
          if (transformEl) {
            transformEl.classList.add('scale-95');
          }
        });
      }

      if (searchPopup) {
        searchPopup.addEventListener('click', (e) => {
          if (e.target === searchPopup) {
            searchPopup.classList.add('opacity-0', 'invisible');
            const transformEl = searchPopup.querySelector('.transform');
            if (transformEl) {
              transformEl.classList.add('scale-95');
            }
          }
        });
      }

      // Mobile Menu
      const mobileMenuTrigger = document.getElementById('mobile-menu-trigger');
      const mobileMenu = document.getElementById('mobile-menu');
      const mobileMenuClose = document.getElementById('mobile-menu-close');

      console.log('Mobile menu elements:', { mobileMenuTrigger, mobileMenu, mobileMenuClose });

      if (mobileMenuTrigger && mobileMenu) {
        mobileMenuTrigger.addEventListener('click', (e) => {
          e.preventDefault();
          e.stopPropagation();
          console.log('Mobile menu trigger clicked');

          // Show the menu
          mobileMenu.classList.remove('opacity-0', 'invisible');

          // Find the sliding panel and show it
          const slidePanel = mobileMenu.querySelector('.transform');
          if (slidePanel) {
            console.log('Sliding panel found, removing translate-x-full');
            slidePanel.classList.remove('translate-x-full');
          } else {
            console.log('Slide panel not found');
          }
        });
      } else {
        console.log('Mobile menu trigger or menu not found');
      }

      if (mobileMenuClose && mobileMenu) {
        mobileMenuClose.addEventListener('click', (e) => {
          e.preventDefault();
          console.log('Mobile menu close clicked');

          const slidePanel = mobileMenu.querySelector('.transform');
          if (slidePanel) {
            slidePanel.classList.add('translate-x-full');
          }

          // Hide after animation
          setTimeout(() => {
            mobileMenu.classList.add('opacity-0', 'invisible');
          }, 300);
        });
      }

      if (mobileMenu) {
        mobileMenu.addEventListener('click', (e) => {
          if (e.target === mobileMenu) {
            console.log('Clicked outside mobile menu');
            const slidePanel = mobileMenu.querySelector('.transform');
            if (slidePanel) {
              slidePanel.classList.add('translate-x-full');
            }

            setTimeout(() => {
              mobileMenu.classList.add('opacity-0', 'invisible');
            }, 300);
          }
        });
      }

      // Escape key handling
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          // Close search popup
          if (searchPopup && !searchPopup.classList.contains('invisible')) {
            searchPopup.classList.add('opacity-0', 'invisible');
            const transformEl = searchPopup.querySelector('.transform');
            if (transformEl) {
              transformEl.classList.add('scale-95');
            }
          }

          // Close mobile menu
          if (mobileMenu && !mobileMenu.classList.contains('invisible')) {
            const slidePanel = mobileMenu.querySelector('.transform');
            if (slidePanel) {
              slidePanel.classList.add('translate-x-full');
            }
            setTimeout(() => {
              mobileMenu.classList.add('opacity-0', 'invisible');
            }, 300);
          }
        }
      });
    });
  </script>
</{{ header_tag }}>

{% schema %}
{
  "name": "Enhanced Header",
  "settings": [
    {
      "type": "select",
      "id": "color_scheme",
      "options": [
        {
          "value": "accent-1",
          "label": "Accent 1"
        },
        {
          "value": "accent-2",
          "label": "Accent 2"
        }
      ],
      "default": "accent-1",
      "label": "Color scheme"
    }
  ]
}
{% endschema %}
