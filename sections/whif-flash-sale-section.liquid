{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }
{%- endstyle -%}

<section class="py-20 bg-background">
  <div class="container mx-auto px-4">
    <div class="flex items-center justify-between mb-12">
      <div>
        <h2 class="font-serif text-4xl md:text-5xl font-bold mb-2 uppercase" style="font-family: var(--font-playfair);">
          whiff responsibly
        </h2>
        <p class="text-lg text-muted-foreground">Check out our collection of scents[oils]</p>
      </div>
      <div class="hidden md:flex gap-2">
        <button
          class="swiper-button-prev-custom inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*='size-'])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border shadow-xs dark:bg-input/30 dark:border-input dark:hover:bg-input/50 size-9 border-primary text-primary hover:bg-primary hover:text-primary-foreground bg-transparent"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="lucide lucide-chevron-left h-5 w-5"
          >
            <path d="m15 18-6-6 6-6"></path>
          </svg>
        </button>
        <button
          class="swiper-button-next-custom inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*='size-'])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border shadow-xs dark:bg-input/30 dark:border-input dark:hover:bg-input/50 size-9 border-primary text-primary hover:bg-primary hover:text-primary-foreground bg-transparent"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="lucide lucide-chevron-right h-5 w-5"
          >
            <path d="m9 18 6-6-6-6"></path>
          </svg>
        </button>
      </div>
    </div>
    <div class="swiper bundles-swiper">
      <div class="swiper-wrapper">
        {% assign collection = collections['whif-landing-page'].products %}
        {% for product in collection limit: 7 %}
          <div class="swiper-slide">
            <div
              data-slot="card"
              class="text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm group overflow-hidden bg-card border-border hover:border-primary transition-all duration-300 h-full"
            >
              <div class="relative h-[300px] overflow-hidden">
                {%- if product.featured_image -%}
                  <img
                    alt="{{ product.featured_image.alt | escape }}"
                    loading="lazy"
                    decoding="async"
                    data-nimg="fill"
                    width="400"
                    height="300"
                    class="object-cover group-hover:scale-105 transition-transform duration-500"
                    src="{{ product.featured_image | image_url: width: 400 }}"
                    style="position: absolute; height: 100%; width: 100%; inset: 0px; color: transparent;"
                  >
                {%- else -%}
                  <div class="absolute inset-0 bg-gray-200 flex items-center justify-center">
                    <span class="text-gray-500">No Image</span>
                  </div>
                {%- endif -%}

                {%- if product.compare_at_price > product.price -%}
                  {%- assign discount_percentage = product.compare_at_price
                    | minus: product.price
                    | times: 100
                    | divided_by: product.compare_at_price
                  -%}
                  <div class="absolute top-4 right-4 bg-primary text-primary-foreground px-3 py-1 text-xs font-bold rounded-full">
                    {{ discount_percentage }}% OFF
                  </div>
                {%- elsif product.tags contains 'new' -%}
                  <div class="absolute top-4 right-4 bg-primary text-primary-foreground px-3 py-1 text-xs font-bold rounded-full">
                    NEW
                  </div>
                {%- elsif product.tags contains 'bestseller' or product.tags contains 'popular' -%}
                  <div class="absolute top-4 right-4 bg-primary text-primary-foreground px-3 py-1 text-xs font-bold rounded-full">
                    POPULAR
                  </div>
                {%- elsif product.tags contains 'premium' or product.tags contains 'luxury' -%}
                  <div class="absolute top-4 right-4 bg-primary text-primary-foreground px-3 py-1 text-xs font-bold rounded-full">
                    PREMIUM
                  </div>
                {%- endif -%}
              </div>
              <div class="p-6">
                <h3 class="text-xl font-bold mb-2 text-foreground">{{ product.title | upcase }}</h3>
                <p class="text-sm text-muted-foreground mb-4 line-clamp-2">
                  {%- if product.description != blank -%}
                    {{ product.description | strip_html | truncate: 80 }}
                  {%- else -%}
                    Premium fragrance collection
                  {%- endif -%}
                </p>
                <div class="flex items-center gap-2 mb-4">
                  <span class="text-2xl font-bold text-primary">{{ product.price | money }}</span>
                  {%- if product.compare_at_price > product.price -%}
                    <span class="text-sm text-muted-foreground line-through">
                      {{- product.compare_at_price | money -}}
                    </span>
                  {%- endif -%}
                </div>
                <form action="{{ routes.cart_add_url }}" method="post" enctype="multipart/form-data">
                  <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
                  <button
                    type="submit"
                    data-slot="button"
                    class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*='size-'])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive shadow-xs h-9 px-4 py-2 has-[&gt;svg]:px-3 w-full bg-primary hover:bg-primary/90 text-primary-foreground"
                    {%- unless product.available -%}
                      disabled
                    {%- endunless -%}
                  >
                    {%- if product.available -%}
                      ADD TO CART
                    {%- else -%}
                      SOLD OUT
                    {%- endif -%}
                  </button>
                </form>
              </div>
            </div>
          </div>
        {%- endfor -%}

        <!-- Fallback: Show original hardcoded slide when no collection is selected -->
      </div>

      <!-- Swiper Pagination -->
      <div class="swiper-pagination-custom flex justify-center gap-2 mt-8 md:hidden"></div>
    </div>
  </div>
</section>

<!-- Swiper CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">

<!-- Swiper JS -->
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const swiper = new Swiper('.bundles-swiper', {
      // Basic settings
      slidesPerView: 1,
      spaceBetween: 24,
      loop: true,
      autoplay: {
        delay: 3000,
        disableOnInteraction: false,
        pauseOnMouseEnter: true,
      },
      // Responsive breakpoints
      breakpoints: {
        640: {
          slidesPerView: 2,
          spaceBetween: 24,
        },
        1024: {
          slidesPerView: 3,
          spaceBetween: 24,
        },
      },

      // Navigation arrows
      navigation: {
        nextEl: '.swiper-button-next-custom',
        prevEl: '.swiper-button-prev-custom',
      },

      // Pagination dots
      pagination: {
        el: '.swiper-pagination-custom',
        clickable: true,
        renderBullet: function (index, className) {
          return (
            '<span class="' +
            className +
            ' w-2 h-2 rounded-full bg-muted cursor-pointer transition-colors duration-200"></span>'
          );
        },
      },

      // Touch settings
      touchRatio: 1,
      touchAngle: 45,
      grabCursor: true,

      // Smooth transitions
      speed: 300,
      effect: 'slide',
    });

    // Custom pagination styling
    const paginationBullets = document.querySelectorAll('.swiper-pagination-custom .swiper-pagination-bullet');
    paginationBullets.forEach((bullet) => {
      bullet.addEventListener('click', function () {
        paginationBullets.forEach((b) => b.classList.remove('bg-primary'));
        paginationBullets.forEach((b) => b.classList.add('bg-muted'));
        this.classList.remove('bg-muted');
        this.classList.add('bg-primary');
      });
    });

    // Update active bullet on slide change
    swiper.on('slideChange', function () {
      paginationBullets.forEach((b) => b.classList.remove('bg-primary'));
      paginationBullets.forEach((b) => b.classList.add('bg-muted'));
      const activeBullet = document.querySelector('.swiper-pagination-custom .swiper-pagination-bullet-active');
      if (activeBullet) {
        activeBullet.classList.remove('bg-muted');
        activeBullet.classList.add('bg-primary');
      }
    });
  });
</script>

{% schema %}
{
  "name": "Whif Flash Sale Section",
  "tag": "section",
  "class": "section",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "inline_richtext",
      "id": "heading",
      "default": "Flash Sale",
      "label": "Heading"
    },
    {
      "type": "text",
      "id": "countdown_end_date",
      "label": "Countdown end date",
      "info": "Format: YYYY-MM-DD HH:MM:SS"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "min": 2,
      "max": 12,
      "step": 1,
      "default": 4,
      "label": "Number of products to show"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "Section padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Top padding",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Bottom padding",
      "default": 36
    }
  ],
  "blocks": [
    {
      "type": "cta_button",
      "name": "Button",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "button_label",
          "default": "Shop All Sale Items",
          "label": "Button label"
        },
        {
          "type": "url",
          "id": "button_link",
          "label": "Button link"
        },
        {
          "type": "checkbox",
          "id": "button_style_secondary",
          "default": false,
          "label": "Use outline button style"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Whif Flash Sale Section",
      "blocks": [
        {
          "type": "cta_button"
        }
      ]
    }
  ]
}
{% endschema %}
