<div class="whif-testimonial-section color-{{ section.settings.color_scheme }} gradient">
  <div class="page-width section-{{ section.id }}-padding">
    <div class="whif-testimonial-content">
      {%- if section.settings.heading != blank -%}
        <h2 class="whif-testimonial__heading">{{ section.settings.heading }}</h2>
      {%- endif -%}

      {%- if section.settings.description != blank -%}
        <div class="whif-testimonial__description rte">
          {{ section.settings.description }}
        </div>
      {%- endif -%}

      <div class="whif-testimonial__grid">
        {%- for block in section.blocks -%}
          {%- case block.type -%}
            {%- when 'testimonial' -%}
              <div class="testimonial-card" {{ block.shopify_attributes }}>
                <div class="testimonial-content">
                  {%- if block.settings.rating != blank -%}
                    <div class="testimonial-rating">
                      {%- assign rating = block.settings.rating | plus: 0 -%}
                      {%- for i in (1..5) -%}
                        {%- if i <= rating -%}
                          <span class="star filled">‚òÖ</span>
                        {%- else -%}
                          <span class="star">‚òÜ</span>
                        {%- endif -%}
                      {%- endfor -%}
                    </div>
                  {%- endif -%}

                  <blockquote class="testimonial-quote">"{{ block.settings.testimonial_text }}"</blockquote>

                  <div class="testimonial-author">
                    {%- if block.settings.customer_photo != blank -%}
                      <div class="author-photo">
                        {{
                          block.settings.customer_photo
                          | image_url: width: 80
                          | image_tag: loading: 'lazy', alt: block.settings.customer_name
                        }}
                      </div>
                    {%- endif -%}
                    <div class="author-info">
                      <cite class="author-name">{{ block.settings.customer_name }}</cite>
                      {%- if block.settings.customer_title != blank -%}
                        <span class="author-title">{{ block.settings.customer_title }}</span>
                      {%- endif -%}
                      {%- if block.settings.customer_location != blank -%}
                        <span class="author-location">{{ block.settings.customer_location }}</span>
                      {%- endif -%}
                    </div>
                  </div>

                  {%- if block.settings.verified_purchase -%}
                    <div class="verified-badge">
                      <span class="verified-icon">‚úì</span>
                      Verified Purchase
                    </div>
                  {%- endif -%}
                </div>
              </div>

            {%- when 'review_summary' -%}
              <div class="review-summary" {{ block.shopify_attributes }}>
                <h3>{{ block.settings.summary_title }}</h3>
                <div class="summary-stats">
                  {%- if block.settings.total_reviews != blank -%}
                    <div class="stat-item">
                      <span class="stat-number">{{ block.settings.total_reviews }}</span>
                      <span class="stat-label">Total Reviews</span>
                    </div>
                  {%- endif -%}
                  {%- if block.settings.average_rating != blank -%}
                    <div class="stat-item">
                      <span class="stat-number">{{ block.settings.average_rating }}</span>
                      <span class="stat-label">Average Rating</span>
                    </div>
                  {%- endif -%}
                  {%- if block.settings.satisfaction_rate != blank -%}
                    <div class="stat-item">
                      <span class="stat-number">{{ block.settings.satisfaction_rate }}%</span>
                      <span class="stat-label">Satisfaction Rate</span>
                    </div>
                  {%- endif -%}
                </div>
              </div>

            {%- when 'video_testimonial' -%}
              <div class="video-testimonial" {{ block.shopify_attributes }}>
                <h4>{{ block.settings.video_title }}</h4>
                {%- if block.settings.video_url != blank -%}
                  <div class="video-wrapper">
                    {%- if block.settings.video_url contains 'youtube.com'
                      or block.settings.video_url contains 'youtu.be'
                    -%}
                      <iframe src="{{ block.settings.video_url }}" frameborder="0" allowfullscreen></iframe>
                    {%- else -%}
                      <video controls>
                        <source src="{{ block.settings.video_url }}" type="video/mp4">
                        Your browser does not support the video tag.
                      </video>
                    {%- endif -%}
                  </div>
                {%- endif -%}
                <p class="video-description">{{ block.settings.video_description }}</p>
              </div>

            {%- when 'button' -%}
              {%- if block.settings.button_label != blank -%}
                <a
                  {% if block.settings.button_link == blank %}
                    role="link" aria-disabled="true"
                  {% else %}
                    href="{{ block.settings.button_link }}"
                  {% endif %}
                  class="button{% if block.settings.button_style_secondary %} button--secondary{% else %} button--primary{% endif %}"
                  {{ block.shopify_attributes }}
                >
                  {{ block.settings.button_label | escape }}
                </a>
              {%- endif -%}
          {%- endcase -%}
        {%- endfor -%}
      </div>

      {%- if section.settings.show_trust_badges -%}
        <div class="trust-badges">
          <div class="trust-badge">
            <span class="badge-icon">üõ°Ô∏è</span>
            <span>Secure Shopping</span>
          </div>
          <div class="trust-badge">
            <span class="badge-icon">üì¶</span>
            <span>Fast Shipping</span>
          </div>
          <div class="trust-badge">
            <span class="badge-icon">‚Ü©Ô∏è</span>
            <span>Easy Returns</span>
          </div>
          <div class="trust-badge">
            <span class="badge-icon">üí¨</span>
            <span>24/7 Support</span>
          </div>
        </div>
      {%- endif -%}
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Whif Testimonial Section",
  "tag": "section",
  "class": "section",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "inline_richtext",
      "id": "heading",
      "default": "What Our Customers Say",
      "label": "Heading"
    },
    {
      "type": "richtext",
      "id": "description",
      "default": "<p>Don't just take our word for it - hear from our satisfied customers.</p>",
      "label": "Description"
    },
    {
      "type": "checkbox",
      "id": "show_trust_badges",
      "default": true,
      "label": "Show trust badges"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "Section padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Top padding",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Bottom padding",
      "default": 36
    }
  ],
  "blocks": [
    {
      "type": "testimonial",
      "name": "Customer Testimonial",
      "limit": 6,
      "settings": [
        {
          "type": "textarea",
          "id": "testimonial_text",
          "default": "This product exceeded my expectations. The quality is outstanding and the scent is perfect for my space.",
          "label": "Testimonial text"
        },
        {
          "type": "text",
          "id": "customer_name",
          "default": "Sarah Johnson",
          "label": "Customer name"
        },
        {
          "type": "text",
          "id": "customer_title",
          "label": "Customer title/role"
        },
        {
          "type": "text",
          "id": "customer_location",
          "label": "Customer location"
        },
        {
          "type": "image_picker",
          "id": "customer_photo",
          "label": "Customer photo"
        },
        {
          "type": "range",
          "id": "rating",
          "min": 1,
          "max": 5,
          "step": 1,
          "default": 5,
          "label": "Star rating"
        },
        {
          "type": "checkbox",
          "id": "verified_purchase",
          "default": true,
          "label": "Show verified purchase badge"
        }
      ]
    },
    {
      "type": "review_summary",
      "name": "Review Summary",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "summary_title",
          "default": "Customer Reviews",
          "label": "Summary title"
        },
        {
          "type": "text",
          "id": "total_reviews",
          "default": "1,247",
          "label": "Total reviews"
        },
        {
          "type": "text",
          "id": "average_rating",
          "default": "4.8",
          "label": "Average rating"
        },
        {
          "type": "text",
          "id": "satisfaction_rate",
          "default": "96",
          "label": "Satisfaction rate"
        }
      ]
    },
    {
      "type": "video_testimonial",
      "name": "Video Testimonial",
      "limit": 2,
      "settings": [
        {
          "type": "text",
          "id": "video_title",
          "default": "Customer Story",
          "label": "Video title"
        },
        {
          "type": "url",
          "id": "video_url",
          "label": "Video URL"
        },
        {
          "type": "textarea",
          "id": "video_description",
          "label": "Video description"
        }
      ]
    },
    {
      "type": "button",
      "name": "Button",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "button_label",
          "default": "Read More Reviews",
          "label": "Button label"
        },
        {
          "type": "url",
          "id": "button_link",
          "label": "Button link"
        },
        {
          "type": "checkbox",
          "id": "button_style_secondary",
          "default": false,
          "label": "Use outline button style"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Whif Testimonial Section",
      "blocks": [
        {
          "type": "testimonial"
        },
        {
          "type": "testimonial"
        },
        {
          "type": "review_summary"
        },
        {
          "type": "button"
        }
      ]
    }
  ]
}
{% endschema %}
